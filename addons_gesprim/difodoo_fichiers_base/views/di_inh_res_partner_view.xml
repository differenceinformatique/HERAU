<?xml version="1.0" encoding="UTF-8"?>
<odoo>
	<data>
		<!-- surcharge du formulaire - Commun Clients/Fournisseurs -->
		<record id="di_view_partner_form" model="ir.ui.view">
			<field name="name">di.res.partner.form</field>
			<field name="model">res.partner</field>
			<field name="inherit_id" ref="base.view_partner_form" />
			<field eval="99" name="priority" />
			<field name="arch" type="xml">
				<!-- suppression du code interne à l'emplacement initial -->
				<xpath expr="/form/sheet/notebook/page/group/group/field[@name='ref']" position="replace">
				</xpath>
				<!-- ajout du code interne juste avant le nom - obligatoire pour les clients/fournisseurs-->
				<xpath expr="//field[@name='name']" position="before">
					<field name="di_ref_required" invisible="1"/>
					<h1>
						<field name="ref" placeholder="Code tiers" attrs="{'required':[('di_ref_required', '==', True)], 'readonly':[('ref','!=',False)]}" />						
					</h1>
				</xpath>
				<!-- masquage des éléments client en fournisseur et inversement -->
				<xpath expr="//group[@name='purchase']" position="attributes">
					<attribute name="attrs">{'invisible':[('customer', '=', True)]}</attribute>
				</xpath>
				<xpath expr="//group[@name='acc_purchase']" position="attributes">
					<attribute name="attrs">{'invisible':[('customer', '=', True)]}</attribute>
				</xpath>
				<xpath expr="//field[@name='property_account_payable_id']" position="attributes">
					<attribute name="attrs">{'invisible':[('customer', '=', True)]}</attribute>
				</xpath>
				<xpath expr="//group[@name='sale']" position="attributes">
					<attribute name="attrs">{'invisible':[('supplier', '=', True)]}</attribute>
				</xpath>
				<xpath expr="//group[@name='acc_sale']" position="attributes">
					<attribute name="attrs">{'invisible':[('supplier', '=', True)]}</attribute>
				</xpath>
				<xpath expr="//field[@name='property_account_receivable_id']" position="attributes">
					<attribute name="attrs">{'invisible':[('supplier', '=', True)]}</attribute>
				</xpath>
				<!-- ajout onglet spécifique -->
				<xpath expr="//page[@name='accounting']" position="after">
					<page name="specifs" string="Compléments" style="font-style: oblique;" col="4">
						<group>
							<group name="editions" string="Editions" attrs="{'invisible':[('customer', '==', False)]}">
								<field name="di_pres_bl" />
							</group>
							<group name="transport" string="Transport" attrs="{'invisible':[('customer', '==', False)]}">
								<field name="di_tournee"/>
								<field name="di_rangtournee"/>
							</group>
						</group>
					</page>
				</xpath>
				<!-- Modif libellé tags + Ajout du code destination -->
				<xpath expr="//field[@name='category_id']" position="replace">
					<field name="di_code_dest_id"/>
					<field name="category_id" widget="many2many_tags" options="{'color_field': 'color', 'no_create_edit': True}" placeholder="Famille..." string="Famille"/>
				</xpath>
				<!-- masquage champ état + modif place ville/code postal sur la 1ère page du formulaire -->
				<xpath expr="//field[@name='city']" position="replace">
				</xpath>
				<xpath expr="//field[@name='state_id']" position="replace">
					<field name="state_id" invisible="1" />
				</xpath>
				<xpath expr="//field[@name='zip']" position="replace">
					<field name="zip" placeholder="ZIP"
						attrs="{'readonly': [('type', '=', 'contact'),('parent_id', '!=', False)]}" />
					<field name="city" placeholder="City"
						attrs="{'readonly': [('type', '=', 'contact'),('parent_id', '!=', False)]}" />
				</xpath>
				<!-- modification affichage contacts/adresses (kanban - on ajoute le champ dans le kanban et on le positionne)-->
				<xpath expr="//field[@name='child_ids']/kanban/field[@name='name']" position="after">
					<field name="di_defaut_adr"/>
					<field name="di_code_dest_id"/>
				</xpath>
				<xpath expr="//field[@name='child_ids']/kanban/templates/t/div/div[2]" position="inside">
					<t t-if="record.type.raw_value != 'contact'">
						<i t-if="record.di_defaut_adr.raw_value " class='fa fa-check'/>
						<field t-if="record.di_code_dest_id.raw_value" name="di_code_dest_id"/>
					</t>				
				</xpath>
				<!-- masquage champ état + modif place ville/code postal dans le formulaire contact/adresse -->
				<xpath expr="//notebook/page/field/form/sheet/group/group/div/div/field[@name='city']"
					position="replace">
				</xpath>
				<xpath expr="//notebook/page/field/form/sheet/group/group/div/div/field[@name='state_id']"
					position="replace">
					<field name="state_id" invisible="1" />
				</xpath>
				<xpath expr="//notebook/page/field/form/sheet/group/group/div/div/field[@name='zip']"
					position="replace">
					<field name="zip" placeholder="ZIP" />
					<field name="city" placeholder="City" />
				</xpath>
				<!-- ajout coche adresse par défaut-->
				<xpath expr="//notebook/page/field/form/sheet/field[@name='type']" position="after">
					<p/>
					<label for="di_defaut_adr" attrs="{'invisible':[('type', '!=', 'delivery'),('type', '!=', 'invoice')]}" />
					<field name="di_defaut_adr" attrs="{'invisible':[('type', '!=', 'delivery'),('type', '!=', 'invoice')]}" />
				</xpath>
				<xpath expr="//notebook/page/field/form/sheet/group/group[1]" position="inside">
					<field name="di_code_dest_id" attrs="{'invisible':[('type', '!=', 'delivery'),('type', '!=', 'invoice')]}" />
				</xpath>
				<!-- Ajout dans l'onglet Ventes & achats -->
				<xpath expr="//group[@name='sale']/field[@name='user_id']" position="after">
					<field name="di_code_tarif_id" />
				</xpath>
				<xpath expr="//field[@name='property_payment_term_id']" position="replace">
					<!-- Modification libellé trop long -->
					<label string="Conditions paiement" />
					<field name="property_payment_term_id" widget="selection" nolabel="1" />
				</xpath>
				<xpath expr="//field[@name='trust']" position="replace">
					<!-- Modification libellé trop long -->
					<label string="Niveau de confiance" />
					<field name="trust" groups="base.group_no_one" nolabel="1" />
					<field name="di_period_fact"/>
					<field name="di_regr_fact"/>
				</xpath>
				<xpath expr="//field[@name='property_supplier_payment_term_id']" position="replace">
					<!-- Modification libellé trop long -->
					<label string="Conditions paiement" />
					<field name="property_supplier_payment_term_id" widget="selection" nolabel="1" />
				</xpath>
				<xpath expr="//div[@class='oe_chatter']" position="replace"/>
			</field>
		</record>
		<!-- modification vue kanban par défaut, on préfère le mode liste - Clients -->
		<record model="ir.actions.act_window.view" id="base.action_partner_form_view1">
			<field eval="3" name="sequence" />
		</record>
		<!-- modification vue liste - Commune Clients/Fournisseurs -->
		<record id="di_view_partner_tree" model="ir.ui.view">
			<field name="name">di.view_partner_tree</field>
			<field name="model">res.partner</field>
			<field name="inherit_id" ref="base.view_partner_tree" />
			<field eval="99" name="priority" />
			<field name="arch" type="xml">
				<!-- modification ordre de tri -->
				<xpath expr="//tree" position="attributes">
					<attribute name="default_order">ref</attribute>
				</xpath>
				<!-- ajout code tiers -->
				<xpath expr="//field[@name='display_name']" position="before">
					<field name="ref" string="Code tiers" />
				</xpath>
				<!-- ajout code postal, ville, pays(invisible en standard) -->
				<xpath expr="//field[@name='country_id']" position="replace">
					<field name="zip" />
					<field name="city" />
					<field name="country_id" />
				</xpath>
			</field>
		</record>
		<!-- modification vue kanban par défaut, on préfère le mode liste - Fournisseurs -->
		<record model="ir.actions.act_window.view" id="base.action_partner_vendor_form_view1">
			<field eval="4" name="sequence" />
		</record>
		<!-- modification formulaire adresse -->
		<record id="di_view_partner_address_form" model="ir.ui.view">
			<field name="name">di.res.partner.form.address</field>
			<field name="model">res.partner</field>
			<field name="inherit_id" ref="base.view_partner_address_form" />
			<field eval="99" name="priority" />
			<field name="arch" type="xml">
				<!-- ajout coche adresse par défaut-->
				<xpath expr="//group/group[2]" position="inside">
					<field name="di_code_dest_id" attrs="{'invisible':[('type', '!=', 'delivery'),('type', '!=', 'invoice')]}" />
					<field name="di_defaut_adr" attrs="{'invisible':[('type', '!=', 'delivery'),('type', '!=', 'invoice')]}" />					
				</xpath>
				<!-- <xpath expr="//div[@class='oe_chatter']" position="replace"/> -->
			</field>
		</record>
	</data>
</odoo>
 